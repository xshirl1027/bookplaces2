{"version":3,"sources":["webpack:///src/app/places/offers/offer-item/offer-item.component.html","webpack:///src/app/places/offers/offers.page.html","webpack:///src/app/places/offers/offer-item/offer-item.component.scss","webpack:///src/app/places/offers/offer-item/offer-item.component.ts","webpack:///src/app/places/offers/offers.module.ts","webpack:///src/app/places/offers/offers.page.scss","webpack:///src/app/places/offers/offers.page.ts","webpack:///src/app/places/place.model.ts","webpack:///src/app/places/places.service.ts"],"names":["OfferItemComponent","selector","template","routes","path","component","OffersPageModule","imports","forChild","declarations","OffersPage","placesService","router","authService","loadingCtrl","alertCtrl","isLoading","userId","subscribe","placesSub","places","offers","fetchOffers","offerId","slidingItem","close","navigate","create","header","message","buttons","text","role","handler","console","log","then","loadingEl","present","deletePlace","fetchPlaces","dismiss","ctrl","unsubscribe","Place","id","title","description","price","availableFrom","availableTo","location","imageDataUrl","PlacesService","http","_places","pipe","get","firebaseUrl","resData","key","hasOwnProperty","push","Date","next","user","res","checkUserIsAdmin","userIsAdmin","placeData","dateFrom","dateTo","imageDataURL","generatedId","newPlace","Error","Math","random","toString","post","name","concat","placeId","place","updatedPlaces","length","updatedPlaceIndex","findIndex","pl","put","asObservable","providedIn"],"mappings":"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","file":"offers-offers-module-es5.js","sourcesContent":["export default \"<ion-item>\\n  <ion-thumbnail slot=\\\"start\\\">\\n    <ion-img [src]=\\\"offer.imageDataUrl\\\"></ion-img>\\n  </ion-thumbnail>\\n  <ion-label>\\n    <h1>{{ offer.title }}</h1>\\n    <div class=\\\"offer-details\\\">\\n      <ion-icon name=\\\"calendar\\\" color=\\\"primary\\\"></ion-icon>\\n      <ion-text color=\\\"tertiary\\\" class=\\\"space-left\\\">{{\\n        offer.availableFrom | date\\n      }}</ion-text>\\n      <span class=\\\"space-left\\\">to</span>\\n      <ion-icon name=\\\"calendar\\\" class=\\\"space-left\\\" color=\\\"primary\\\"></ion-icon>\\n      <ion-text color=\\\"tertiary\\\" class=\\\"space-left\\\">{{\\n        offer.availableTo | date\\n      }}</ion-text>\\n    </div>\\n  </ion-label>\\n</ion-item>\\n\";","export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button></ion-menu-button>\\n    </ion-buttons>\\n    <ion-title>My Offers</ion-title>\\n    <ion-buttons slot=\\\"primary\\\">\\n      <ion-button routerLink=\\\"/places/tabs/offers/new\\\">\\n        <ion-icon name=\\\"add\\\" slot=\\\"icon-only\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"ion-padding\\\">\\n  <ion-grid>\\n    <ion-row>\\n      <ion-col size=\\\"12\\\" size-sm=\\\"8\\\" offset-sm=\\\"2\\\">\\n        <div *ngIf=\\\"isLoading\\\" class=\\\"ion-text-center\\\">\\n          <ion-spinner color=\\\"primary\\\"></ion-spinner>\\n        </div>\\n        <div class=\\\"ion-text-center\\\" *ngIf=\\\"!isLoading && offers && offers.length <= 0\\\">\\n          <p>No offers found! Please create one first!</p>\\n          <ion-button color=\\\"primary\\\" routerLink=\\\"/places/tabs/offers/new\\\"\\n            >Offer New Place</ion-button\\n          >\\n        </div>\\n        <ion-list *ngIf=\\\"!isLoading && offers && offers.length > 0\\\">\\n          <ion-item-sliding *ngFor=\\\"let offer of offers\\\" #slidingItem>\\n            <app-offer-item [offer]=\\\"offer\\\"></app-offer-item>\\n            <ion-item-options side=\\\"end\\\">\\n                <ion-item-option\\n                color=\\\"primary\\\"\\n                (click)=\\\"onDelete(offer.id, slidingItem)\\\"\\n              >\\n              <ion-icon name=\\\"trash\\\"  slot=\\\"icon-only\\\"></ion-icon>\\n              </ion-item-option>\\n              <ion-item-option\\n                color=\\\"secondary\\\"\\n                (click)=\\\"onEdit(offer.id, slidingItem)\\\"\\n              >\\n                <ion-icon name=\\\"create\\\" slot=\\\"icon-only\\\"></ion-icon>\\n              </ion-item-option>\\n            </ion-item-options>\\n          </ion-item-sliding>\\n        </ion-list>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\";","export default \"h1 {\\n  font-size: 18px;\\n  border: 1px solid var(--ion-color-primary);\\n  padding: 8px;\\n  border-radius: 5px;\\n  color: var(--ion-color-primary);\\n}\\n\\n.offer-details {\\n  display: flex;\\n  align-items: center;\\n}\\n\\n.offer-details .space-left {\\n  margin-left: 5px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGxhY2VzL29mZmVycy9vZmZlci1pdGVtL29mZmVyLWl0ZW0uY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxlQUFBO0VBQ0EsMENBQUE7RUFDQSxZQUFBO0VBQ0Esa0JBQUE7RUFDQSwrQkFBQTtBQUNGOztBQUVBO0VBQ0UsYUFBQTtFQUNBLG1CQUFBO0FBQ0Y7O0FBQ0U7RUFDRSxnQkFBQTtBQUNKIiwiZmlsZSI6InNyYy9hcHAvcGxhY2VzL29mZmVycy9vZmZlci1pdGVtL29mZmVyLWl0ZW0uY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJoMSB7XG4gIGZvbnQtc2l6ZTogMThweDtcbiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0taW9uLWNvbG9yLXByaW1hcnkpO1xuICBwYWRkaW5nOiA4cHg7XG4gIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgY29sb3I6IHZhcigtLWlvbi1jb2xvci1wcmltYXJ5KTtcbn1cblxuLm9mZmVyLWRldGFpbHMge1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuXG4gIC5zcGFjZS1sZWZ0IHtcbiAgICBtYXJnaW4tbGVmdDogNXB4O1xuICB9XG59XG4iXX0= */\";","import { Component, OnInit, Input } from '@angular/core';\n\nimport { Place } from '../../place.model';\n\n@Component({\n  selector: 'app-offer-item',\n  templateUrl: './offer-item.component.html',\n  styleUrls: ['./offer-item.component.scss']\n})\nexport class OfferItemComponent implements OnInit {\n  @Input() offer: Place;\n\n  constructor() { }\n\n  ngOnInit() {\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { OffersPage } from './offers.page';\nimport { OfferItemComponent } from './offer-item/offer-item.component';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: OffersPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [OffersPage, OfferItemComponent]\n})\nexport class OffersPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BsYWNlcy9vZmZlcnMvb2ZmZXJzLnBhZ2Uuc2NzcyJ9 */\";","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { AlertController, IonItemSliding, LoadingController } from '@ionic/angular';\n\nimport { Router } from '@angular/router';\nimport { Subscription } from 'rxjs';\n\nimport { PlacesService } from '../places.service';\nimport { Place } from '../place.model';\nimport { take, switchMap, map } from 'rxjs/operators';\nimport { AuthService } from 'src/app/auth/auth.service';\n\n@Component({\n  selector: 'app-offers',\n  templateUrl: './offers.page.html',\n  styleUrls: ['./offers.page.scss']\n})\nexport class OffersPage implements OnInit, OnDestroy {\n  offers: Place[];\n  isLoading = false;\n  private placesSub: Subscription;\n\n  constructor(private placesService: PlacesService, \n    private router: Router,\n     private authService: AuthService,\n     private loadingCtrl: LoadingController,\n    private alertCtrl: AlertController) {}\n\n  ngOnInit() {\n    this.authService.userId.subscribe(userId => {\n      this.placesSub = this.placesService.places.subscribe(places => {\n        this.offers = places;\n      });\n    });\n  }\n\n  ionViewWillEnter() {\n    this.isLoading = true;\n    this.placesService.fetchOffers().subscribe(() => {\n      this.isLoading = false;\n    });\n  }\n\n  onEdit(offerId: string, slidingItem: IonItemSliding) {\n    slidingItem.close();\n    this.router.navigate(['/', 'places', 'tabs', 'offers', 'edit', offerId]);\n  }\n\n  onDelete(offerId: string, slidingItem: IonItemSliding) {\n    this.alertCtrl.create({header: \"Delete\", message: \"Are you sure you want to delete booking?\", buttons: [{\n      text: 'Cancel',\n      role: 'cancel',\n      handler: () => {\n        slidingItem.close();\n        console.log('Cancel clicked');\n      }\n    },\n    {\n      text: 'Delete',\n      handler: () => {\n        slidingItem.close();\n        this.loadingCtrl.create({ message: 'deleting...' }).then(loadingEl => {\n          loadingEl.present();\n          this.isLoading = true;\n          this.placesService.deletePlace(offerId).subscribe(() => {\n            this.placesService.fetchPlaces().subscribe(() => {\n              this.isLoading = false;\n              loadingEl.dismiss();\n            });\n          });\n        });\n      }\n    }]})\n    .then((ctrl) => {\n      ctrl.present();\n    });\n\n  }\n\n  ngOnDestroy() {\n    if (this.placesSub) {\n      this.placesSub.unsubscribe();\n    }\n  }\n}\n","import { PlaceLocation } from './location.model';\n\nexport class Place {\n  constructor(\n    public id: string,\n    public title: string,\n    public description: string,\n    public price: number,\n    public availableFrom: Date,\n    public availableTo: Date,\n    public userId: string,\n    public location: PlaceLocation,\n    public imageDataUrl: string\n  ) {}\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { BehaviorSubject, of, Observable } from 'rxjs';\nimport { take, map, tap, delay, switchMap } from 'rxjs/operators';\n\nimport { Place } from './place.model';\nimport { AuthService } from '../auth/auth.service';\nimport { PlaceLocation } from './location.model';\nimport { environment } from 'src/environments/environment';\n\ninterface PlaceData {\n  availableFrom: string;\n  availableTo: string;\n  description: string;\n  imageUrl: string;\n  price: number;\n  title: string;\n  userId: string;\n  location: PlaceLocation;\n  imageDataUrl: string;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PlacesService {\n  private _places = new BehaviorSubject<Place[]>([]);\n\n  get places() {\n    return this._places.asObservable();\n  }\n\n  constructor(private authService: AuthService, private http: HttpClient) {}\n\n  fetchPlaces() {\n    return this.authService.userId.pipe(switchMap(userId=>{\n      return this.http\n        .get<{ [key: string]: PlaceData }>(\n          `${environment.firebaseUrl}/places.json`\n        )\n        .pipe(\n          map(resData => {\n            const places = [];\n            for (const key in resData) {\n              if (resData.hasOwnProperty(key)) {\n                places.push(\n                  new Place(\n                    key,\n                    resData[key].title,\n                    resData[key].description,\n                    resData[key].price,\n                    new Date(resData[key].availableFrom),\n                    new Date(resData[key].availableTo),\n                    resData[key].userId,\n                    resData[key].location,\n                    resData[key].imageDataUrl\n                  )\n                );\n              }\n            }\n            return places;\n          }),\n          tap(places => {\n            this._places.next(places);\n          })\n        );\n    }));\n  }\n\n  fetchOffers() {\n    let resData;\n    return this.authService.user.pipe(switchMap(user=>{\n      return this.http\n        .get<{ [key: string]: PlaceData }>(\n          `${environment.firebaseUrl}/places.json`\n        )\n        .pipe(\n          switchMap(res=>{\n            resData=res;\n            return this.authService.checkUserIsAdmin();\n          }),\n          map(userIsAdmin => {\n            const places = [];\n            for (const key in resData) {\n              if (resData.hasOwnProperty(key) && (resData[key].userId==user.id || userIsAdmin==true)) {\n                places.push(\n                  new Place(\n                    key,\n                    resData[key].title,\n                    resData[key].description,\n                    resData[key].price,\n                    new Date(resData[key].availableFrom),\n                    new Date(resData[key].availableTo),\n                    resData[key].userId,\n                    resData[key].location,\n                    resData[key].imageDataUrl\n                  )\n                );\n              }\n            }\n            return places;\n          }),\n          tap(places => {\n            this._places.next(places);\n          })\n        );\n    }));\n  }\n\n  getPlace(id: string) {\n    return this.http\n      .get<PlaceData>(\n        `${environment.firebaseUrl}/places/${id}.json`\n      )\n      .pipe(\n        map(placeData => {\n          return new Place(\n            id,\n            placeData.title,\n            placeData.description,\n            placeData.price,\n            new Date(placeData.availableFrom),\n            new Date(placeData.availableTo),\n            placeData.userId,\n            placeData.location,\n            placeData.imageDataUrl\n          );\n        })\n      );\n  }\n\n  addPlace(\n    title: string,\n    description: string,\n    price: number,\n    dateFrom: Date,\n    dateTo: Date,\n    location: PlaceLocation,\n    imageDataURL: string\n  ) {\n    let generatedId: string;\n    let newPlace: Place;\n    return this.authService.userId.pipe(\n      take(1),\n      switchMap(userId => {\n        if (!userId) {\n          throw new Error('No user found!');\n        }\n        newPlace = new Place(\n          Math.random().toString(),\n          title,\n          description,\n          price,\n          dateFrom,\n          dateTo,\n          userId,\n          location,\n          imageDataURL\n        );\n        return this.http.post<{ name: string }>(\n          `${environment.firebaseUrl}/places.json`,\n          {\n            ...newPlace,\n            id: null\n          }\n        );\n      }),\n      switchMap(resData => {\n        generatedId = resData.name;\n        return this.places;\n      }),\n      take(1),\n      tap(places => {\n        newPlace.id = generatedId;\n        this._places.next(places.concat(newPlace));\n      })\n    );\n  }\n\n  deletePlace(placeId: string) {\n    return this.http.delete(\n      `${environment.firebaseUrl}/places/${placeId}.json`\n    );\n  }\n\n  updatePlace(place: Place) {\n    let updatedPlaces: Place[];\n    return this.places.pipe(\n      take(1),\n      switchMap(places => {\n        if (!places || places.length <= 0) {\n          return this.fetchPlaces();\n        } else {\n          return of(places);\n        }\n      }),\n      switchMap(places => {\n        const updatedPlaceIndex = places.findIndex(pl => pl.id === place.id);\n        updatedPlaces = [...places];\n        updatedPlaces[updatedPlaceIndex] = place;\n        return this.http.put(\n          `${environment.firebaseUrl}/places/${place.id}.json`,\n          { ...updatedPlaces[updatedPlaceIndex], id: null }\n        );\n      }),\n      tap(() => {\n        this._places.next(updatedPlaces);\n      })\n    );\n  }\n}\n"]}